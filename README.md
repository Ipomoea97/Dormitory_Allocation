# 宿舍分配系统

基于多维特征驱动AI模型的新生宿舍分配系统，使用遗传算法优化和SHAP解释性分析。

## 🎯 项目特点

- **多维特征分析**：整合性别、年龄、MBTI、作息时间、兴趣爱好等10个维度
- **AI驱动决策**：XGBoost兼容性建模，准确预测室友匹配度
- **智能优化**：遗传算法全局寻优，找到最佳宿舍分配方案
- **可解释AI**：SHAP分析提供决策解释，增强系统透明度
- **可视化界面**：Dash Web界面，实时监控优化过程

## 📊 系统架构

```text
宿舍分配系统
├── 数据预处理模块 (data_preprocessing.py)
├── 兼容性模型 (compatibility_model.py)
├── 分配优化模块 (allocation_optimizer.py)
├── 解释模块 (explanation_module.py)
├── 可视化界面 (dashboard_app.py)
└── 主程序 (main.py)
```

## 🚀 快速开始

### 环境要求

- Python 3.8+
- 推荐使用conda环境管理

### 安装依赖

```bash
# 激活conda环境
conda activate pytorch_shap_3129

# 安装依赖包
pip install -r requirements.txt
```

### 运行系统

1.  **完整系统运行**

    ```bash
    python init_system.py
    ```

2.  **直接启动Web界面 (如果已有模型和数据)**

    ```bash
    python dashboard_app.py
    ```

## 📈 系统性能

- **学生规模**：299名学生（男121，女178）
- **优化效率**：100代优化约2-3分钟
- **准确率**：兼容性预测准确率>85%
- **约束满足**：100%满足性别分离约束

## 📁 数据格式

系统需要Excel格式的学生数据文件(`Data.xlsx`)，包含以下列：

| 列名 | 说明 | 示例 |
|------|------|------|
| 姓名 | 学生姓名 | 张三 |
| 性别 | 男/女 | 男 |
| 年龄 | 年龄 | 18 |
| 班级 | 班级信息 | 食品1班 |
| 生源地 | 籍贯 | 广东省广州市 |
| 高考分数 | 分数 | 580 |
| 考生类别 | 类别 | 普通类 |
| MBTI | 性格类型 | ENFJ |
| 作息时间 | 睡觉时间 | 23:00 |
| 兴趣爱好 | 爱好列表 | 唱歌,运动 |

## 🔧 配置参数

### 遗传算法参数

```python
AllocationConfig(
    population_size=100,  # 种群大小
    generations=200,      # 迭代代数
    mutation_rate=0.1,    # 变异率
    crossover_rate=0.8,   # 交叉率
    elite_size=20,        # 精英个体数
)
```

### 兼容性评分权重

- 作息一致性：40%
- 兴趣重叠度：25%
- MBTI互补性：20%
- 学业相似性：10%
- 地域多样性：5%

## 📊 输出文件

- `allocation_results.json`：详细分配结果
- `allocation_system.log`：系统运行日志
- `xgboost_model.json`：训练好的兼容性模型
- `preprocessor.joblib`：训练好的数据预处理器

## 🌐 Web界面功能

访问 `http://localhost:8050` 查看Web界面：

- **数据概览**：学生数据统计和分布
- **分配优化**：实时监控优化过程
- **分配结果**：查看详细分配方案
- **可解释性分析**：SHAP特征重要性分析
- **统计分析**：系统性能统计

## 🔬 技术细节

### 兼容性建模

使用XGBoost回归模型预测学生配对兼容性：
- 输入：两个学生的特征统计量（均值、标准差、最值）
- 输出：兼容性得分（0-1范围）
- 训练数据：基于规则生成的兼容性标签

### 优化算法

遗传算法核心操作：
- **编码**：学生索引到宿舍ID的映射
- **选择**：锦标赛选择
- **交叉**：保持性别约束的部分匹配交叉
- **变异**：同性别学生间的位置交换
- **适应度**：平均兼容性 - 约束违反惩罚

### SHAP解释

- 使用TreeExplainer解释XGBoost模型
- 计算全局特征重要性
- 生成宿舍配对解释
- 可视化决策过程

## 🚨 注意事项

1.  **数据隐私**：确保学生个人信息安全
2.  **性别约束**：系统强制执行性别分离
3.  **计算资源**：大规模优化需要足够计算资源
4.  **参数调优**：根据实际需求调整优化参数

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进系统！

## 📜 许可证

本项目采用MIT许可证。

## 🙏 致谢

感谢食品学院2024级新生数据支持，以及开源社区的技术贡献。

## 📋 版本信息

- **版本**: 2.1
- **状态**: 稳定
